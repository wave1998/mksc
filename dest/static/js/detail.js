$(".cart_counts").text(localStorage.getItem("cart_counts"));var parames=location.search,reg=/id=([1-9]\d*)/,res=parames.match(reg),id=res[1],str="";function bindNumber(){$(".number").click(function(t){var e,a=t.target;"cut"==a.className&&(e=(e=$(a).next().val()-0-1)<=1?1:$(a).next().val()-0-1,$(a).next().val(e));"add"==a.className&&(e=(e=$(a).prev().val()-0+1)>=$(a).nextAll(".stock").text()-0?$(a).nextAll(".stock").text()-0:$(a).prev().val()-0+1,$(a).prev().val(e));subtotal()})}function subtotal(){$(".subtotal").each(function(){var t=$(this).parent().prevAll(".price").children().text()-0,e=$(this).parent().prev().find(".num").val()-0;$(this).text((e*t).toFixed(2))})}function bindClick(l){$("button").click(function(){if(null==getCookie("username"))alert("请先登陆"),location.href="login.html";else{var t=localStorage.getItem("list"),e=0;if(localStorage.clear(),t=JSON.parse(t)){for(var a=0;a<t.length;a++)if(t[a].id==l.id){t[a].number=t[a].number-0+($(".num").val()-0),localStorage.setItem("list",JSON.stringify(t));for(n=0;n<t.length;n++)e+=t[n].number;return localStorage.setItem("cart_counts",e),$(".cart_counts").text(localStorage.getItem("cart_counts")),alert("成功加入购物车"),!1}l.number=$(".num").val()-0,t.push(l),localStorage.setItem("list",JSON.stringify(t));for(n=0;n<t.length;n++)e+=t[n].number;localStorage.setItem("cart_counts",e),$(".cart_counts").text(localStorage.getItem("cart_counts")),alert("成功加入购物车")}else{(t=[]).push(l),l.number=$(".num").val()-0,localStorage.setItem("list",JSON.stringify(t));for(var n=0;n<t.length;n++)e+=t[n].number;localStorage.setItem("cart_counts",e),$(".cart_counts").text(localStorage.getItem("cart_counts")),alert("成功加入购物车")}}})}$.ajax({url:"../static/php/detail.php",type:"post",dataType:"json",data:{d:id},success:function(t){str+='\n        <div class="introduce clearfix">\n        <div class="img fl">\n            <img src="'+t.image+'" alt="">\n        </div>\n        <div class="info fl">\n            <h4>'+t.name+'</h4>\n            <div class="price">单价：￥<span>'+t.price+'</span></div>\n            \n            <div class="number clear_fix">\n                <span>购买数量：</span>\n                <input type="button" value="-" class="cut">\n                <input type="number" class="num" value="1">\n                <input type="button" value="+" class="add">\n                <span style="margin-left:10px;">库存剩余：</span>\n                <span class="stock" >'+t.stock+'\n            </div>\n            <div class="price">总计：￥<span class="subtotal">'+t.price+"</span></div>\n            <button>加入购物车</button>\n        </div>\n    </div>\n        ",$(".listContainer").html(str),bindClick(t),bindNumber()}});